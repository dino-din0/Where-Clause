<!DOCTYPE html>
<html>

<head>
  <title>Maximo Asset Search</title>
  <style>
    body {
      background-color: #F2F2F2;
      /* Background color. Light gray was chosen from the PNNL Website */
      font-family: 'Helvetica', Arial, sans-serif;
      /* Change the font for the whole document */
    }

    /* Header 1 Color (Maximo COMPLOC Search) */
    h1 {
      color: #d77900;
      /*PNNL Orange*/
    }

    /* Header 2 Color (Generated Where Clause) */
    h2 {
      color: #d77900;
      /*PNNL Orange*/
    }

    /* Adjust the width of the input boxes */
    input[type="text"] {
      width: 75%;
      /* Adjust the width as needed */
      box-sizing: border-box;
      /* Include padding and border in the width */
      margin-bottom: 10px;
      /* Add some spacing between input boxes */
    }

    .input-group {
      margin-bottom: 10px;
      /* Add margin to the whole input group */
    }

    .description {
      display: block;
      /* Display the span as a block element */
      margin-top: 5px;
      /* Add margin to the top to separate it from the input */
      font-size: 13px;
      /* Font size */
      color: #4b79c0;
      /* Blue from Maximo */
    }

    /* Style for the horizontal rule */
    hr {
      border: 1px solid #ccc;
      /* Gray border */
      margin: 20px 0;
      /* Margin for spacing */
    }

    #whereClause {
      width: 100%;
      height: 150px;
      font-family: monospace;
    }
  </style>

  <!-- Notification Block Styling -->
  <div id="notification"
    style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: lightgray; padding: 20px; border: 1px solid #000; font-size: 36px;">
  </div>

  
  <script>
    document.addEventListener('keydown', function (event) {
      if (event.key === 'Enter' && !event.shiftKey) {
        event.preventDefault(); // Prevent the default behavior (e.g., new line in a text area)
        generateWhereClause();
      }
    });

    document.addEventListener('keydown', function (event) {
      if (event.key === 'Enter' && event.shiftKey) {
        event.preventDefault(); // Prevent the default behavior (e.g., new line in a text area)
        copyToClipboard();
      }
    });
  </script>
</head>

<body>


  <h1>Maximo COMPLOC Search (Where Clause)</h1>

  <!-- Search for builidngs input -->
  <form id="searchForm">
    <div class="input-group">
      <label for="buildings"><strong>[REQUIRED] Building(s):</strong></label><br>
      <span class="description">Separate multiple building numbers with commas. <strong>NOTE</strong> that the generated
        Where Clause will not work properly in Maximo. Modify the Where Clause output (remove the first "and" in the output), or the
        code, if you are searching without a building </span>
      <input type="text" id="buildings" placeholder="Enter building number(s) (e.g. 331, 3410)">
    </div>

    <!-- Terms to include in the Description input -->
    <div class="input-group">
      <label for="searchInDescription"><strong>Description Search:</strong></label>
      <span class="description">Searches the 'Description' field in Maximo. Use commas to separate different description
        terms (acts as an 'or' operator). Use '&' to search for descriptions containing multiple terms (acts as an 'and'
        operator)</span>

      <span class="description"> Example: If you do "331" as the 'Building' and "CHW & PMP, HHW" as the 'Description
        Search' the following logic will apply: 331 with CHW & PMP (in the description) and 331 with HHW (in the
        description) </span>
      <input type="text" id="searchInDescription"
        placeholder="Enter text for searching description (e.g. CHW & PMP, HHW)">
    </div>

    <!-- Exclude Terms in Description input -->
    <div class="input-group">
      <label for="excludeTerms">Exclude Terms in the Description:</label><br>
      <span class="description">Separate multiple terms to exclude from the 'Description' Field with commas. Commas in
        this case will act as an 'and' operator </span>

      <span class="description"> Example: If you input "Aquatics, Animal", your search will <strong>not</strong> include
        "Aquatics" <u>AND</u> "Animals" in the description </span>
      <bk></bk>
      <input type="text" id="excludeTerms"
        placeholder="Enter terms to exclude in the description (e.g. Aquatics, Animal)">
    </div>

    <!-- Horizontal rule to visually separate the parts -->
    <hr>

    <!-- Legacy Asset Number Search input -->
    <div class="input-group">
      <label for="legacyAssetSearch"><strong>Legacy Asset Number Search:</strong></label><br>
      <span class="description">Separate multiple Asset Numbers with commas. Commas will act as an 'or' operator</span>

      <span class="description"> Example: If you input "CHW-PMP, N-DIS", your search will include Asset Numbers with
        "CHW-PMP" <u>OR</u> "N-DIS" </span>
      <input type="text" id="legacyAssetSearch" placeholder="Enter asset numbers to search for (e.g. CHW-PMP, N-DIS)">
    </div>

    <!-- Exclude from Legacy Asset input -->
    <div class="input-group">
      <label for="excludeFromLegacy">Exclude from Legacy Asset:</label><br>
      <span class="description">Separate multiple terms to exclude from the 'Asset Number' Field with commas. Commas in
	will act as an 'and' operator</span>

      <span class="description">Example: If you input "HHW-PMP, E-DIS", your search will <strong>not</strong> include
        Asset Numbers with "HHW-PMP" <u>AND</u> "E-DIS" </span>
      <bk></bk>
      <input type="text" id="excludeFromLegacy" placeholder="Enter asset numbers to exclude (e.g. HHW-PMP, E-DIS)">
    </div>

    <!-- Horizontal rule to visually separate the parts -->
    <hr>

    <!-- Status field input -->
    <div class="input-group">
      <label for="statusCheckboxes"><strong>Status(es):</strong></label><br>
      <span class="description">Leave this blank to search for all statuses. Otherwise, select the statuses you
        need</span>
      <label for="status_operating">
        <input type="checkbox" id="status_operating" value="OPERATING"> OPERATING
      </label>
      <br>
      <label for="status_active">
        <input type="checkbox" id="status_active" value="ACTIVE"> ACTIVE
      </label>
      <br>
      <label for="status_decommissioned">
        <input type="checkbox" id="status_decommissioned" value="DECOMMISSIONED"> DECOMMISSIONED
      </label>
      <br>
      <label for="status_retired">
        <input type="checkbox" id="status_retired" value="RETIRED"> RETIRED
      </label>
      <br>
      <label for="status_inactive">
        <input type="checkbox" id="status_inactive" value="INACTIVE"> INACTIVE
      </label>
      <br>
      <label for="status_not_ready">
        <input type="checkbox" id="status_not_ready" value="NOT READY"> NOT READY
      </label>
      <br>
      <label for="status_disposed">
        <input type="checkbox" id="status_disposed" value="DISPOSED"> DISPOSED
      </label>
      <br>
      <label for="status_prepare_for_use">
        <input type="checkbox" id="status_prepare_for_use" value="PREPARE FOR USE"> PREPARE FOR USE
      </label>
      <br>
      <label for="status_storage">
        <input type="checkbox" id="status_storage" value="STORAGE"> STORAGE
      </label>
      <br>
      <label for="status_unoccupied">
        <input type="checkbox" id="status_unoccupied" value="UNOCCUPIED"> UNOCCUPIED
      </label>
      <br>
      <label for="status_draft">
        <!-- This should not yield any results, though it has been added in the event that there was a "draft" COMPLOC that is created -->
        <input type="checkbox" id="status_draft" value="DRAFT"> DRAFT
      </label>
      <br>

      </select>

      <!-- Horizontal rule to visually separate the parts -->
      <hr>

      <!-- Generate Where Clause Button-->
      <button type="button" onclick="generateWhereClause()">Generate Where Clause</button>
      <span class="description"> Click "Generate Where Clause" to create the Where Clause based on the input above. You
        can also press <strong>Enter</strong> on your Keyboard </span>

  </form>

  <!-- Horizontal rule to visually separate the parts -->
  <hr>

  <h2>Generated Where Clause:</h2>
  <textarea id="whereClause" readonly></textarea>

  <button onclick="copyToClipboard()">Copy to Clipboard</button><br>
  <span class="description"> Click "Copy to Clipboard" to copy the Generated Where Clause above. You can also press
    <strong>Shift + Enter</strong> on your Keyboard </span>
  <!-- Where Clause from the Inputs -->
  <script>
    function generateWhereClause() {
      // Retrive valuves from the inputs
      function sanitizeInput(input) {
        // Remove extra spaces, leading/trailing commas, and invalid characters
        return input
          .replace(/\s+/g, ' ')       // Remove extra spaces
          .replace(/(^,|,$)/g, '')    // Remove leading/trailing commas
          .replace(/[\^*~.!@#]/g, '')  // Remove invalid characters (^ * ~ . ! @ #)
          .split(',')
          .filter(item => item.trim() !== '') // Remove empty items after splitting
          .join(', ');
      }

      const buildings = sanitizeInput(document.getElementById('buildings').value);
      const searchInDescription = sanitizeInput(document.getElementById('searchInDescription').value);
      const excludeTerms = sanitizeInput(document.getElementById('excludeTerms').value);
      const legacyAssetSearch = sanitizeInput(document.getElementById('legacyAssetSearch').value);
      const excludeFromLegacy = sanitizeInput(document.getElementById('excludeFromLegacy').value);


      const selectedStatuses = [];
      const checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');
      checkboxes.forEach(checkbox => {
        selectedStatuses.push(checkbox.value);
      });

      if (!buildings) {
        alert('ERROR: No building number was entered. The Where Clause will not work properly unless a modification (remove the first "and"), or changes to the code are made. A Where Clause will still be generated.');
      }

      // Start of creating the Where Clause
      let whereClause = '(\n  (\n';

      // Building search condition based on the number of searchInDescription terms
      if (buildings) {
        const buildingNumbers = buildings.split(',').map(item => item.trim());
        if (searchInDescription) {
          let descriptionSearch = '';
          buildingNumbers.forEach(num => {
            descriptionSearch += searchInDescription.split(',').map(term => `${num} ~${term}`).join(' | ') + ' | ';
          });
          descriptionSearch = descriptionSearch.slice(0, -3); // Remove the trailing ' | '
          whereClause += `    contains(description, '${descriptionSearch}')\n`;
        } else {
          // If there are no searchInDescription terms, use buildings only
          let descriptionSearch = buildingNumbers.map(num => `${num}`).join(' | ');
          whereClause += `    contains(description, '${descriptionSearch}')\n`;
        }
      }

      // Legacy Asset Number Search condition
      if (legacyAssetSearch) {
        // Split the legacy asset search terms and trim each term
        const legacyAssetTerms = legacyAssetSearch.split(',').map(term => term.trim());

        if (legacyAssetTerms.length === 1) {
          // If only one term, use 'and'
          whereClause += `    and (legacyassetnum like '%${legacyAssetTerms[0]}%')\n`;
        } else {
          // If more than one term, use 'and' for the first term, and 'or' for the rest
          whereClause += `    and ((legacyassetnum like '%${legacyAssetTerms[0]}%')\n`;
          for (let i = 1; i < legacyAssetTerms.length; i++) {
            whereClause += `    or (legacyassetnum like '%${legacyAssetTerms[i]}%')\n`;
          }
          whereClause += '    )\n';  // Close the parenthesis for the 'and' condition
        }
      }

      // Statuses search condition
      if (selectedStatuses.length > 0) {
        whereClause += '    and (';
        whereClause += selectedStatuses.map(status => `upper(status) = '${status}'`).join(' or ');
        whereClause += ')\n';
      }


      // Where Clause Filler Text
      // Site ID condition
      whereClause += '    and siteid = \'PNNLSITE\'\n';
      whereClause += '  )\n';
      whereClause += '  and (\n';

      // 'Type in' condition 
      whereClause += `    type in ('COURIER', 'HOLDING', 'LABOR', 'ALTWORK', 'AREA', 'BLDG', 'CAD', 'CAMPUS', 'COMPLOC', 'CONFERENCE ROOM', 'CUBICLE', 'FACILITIES', 'GEO', 'LACTATION ROOM', 'OPERATING', 'PHONE BOOTH', 'PNNL', 'PRIVATE OFFICE', 'SHARED OFFICE', 'SPACE', 'SYSBLDG' , 'SYSFUNC' , 'SYSGRP' , 'SYSSPEC' , 'SYSTEM', 'TRAINING ROOM', 'WHISPER ROOM', 'WORKSTATION', 'REPAIR', 'SALVAGE', 'VENDOR')\n`;


      // Exclude Terms in Description condition
      if (excludeTerms) {
        whereClause += '  )\n  and (\n';
        const excludedTerms = excludeTerms.split(',').map(item => item.trim());
        whereClause += excludedTerms.map(term => `    description not like '%${term}%'`).join('\n    and ');
        whereClause += '\n  )\n';
      } else {
        whereClause += '  )\n';
      }

      // Exclude Terms from Legacy Asset condition
      if (excludeFromLegacy) {
        whereClause += '  )\n  and (\n';
        const excludedFromLegacy = excludeFromLegacy.split(',').map(item => item.trim());
        whereClause += excludedFromLegacy.map(term => `    legacyassetnum not like '%${term}%'`).join('\n    and ');
        whereClause += '\n  )\n';
      } else {
        whereClause += ')\n';
      }

      // Set the generated where clause to the text area
      document.getElementById('whereClause').value = whereClause;

      const notification = document.getElementById('notification');
      notification.textContent = 'Where Clause Generated!';
      notification.style.display = 'block';

      // Automatically hide the notification after a few seconds
      setTimeout(function () {
        notification.style.display = 'none';
      }, 1000); // 1000 milliseconds (1 seconds)
    }

    function copyToClipboard() {
      event.preventDefault(); // Prevent default form submission behavior

      const textarea = document.getElementById('whereClause');
      textarea.select();
      document.execCommand('copy');

      const notification = document.getElementById('notification');
      notification.textContent = 'Where Clause copied to Clipboard!';
      notification.style.display = 'block';

      // Automatically hide the notification after a few seconds
      setTimeout(function () {
        notification.style.display = 'none';
      }, 3000); // 3000 milliseconds (3 seconds)
    }

  </script>

</body>

</html>